<!DOCTYPE html>
<html>
  <head>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <meta charset="utf-8">
    <title>clusterer</title>
	
    <style>
      html, body, #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
	  #legend {
		font-family: Arial, sans-serif;
		font-size: 0.75em;
		font-weight: bold;
		text-transform: uppercase;
		background: #fff;
		opacity: 0.85;
		padding: 5px;
		margin: 5px;
		border: 2px solid #999;
	  }
	  #legend img {
		vertical-align: middle;
	  }
	  #legendTitle {
		font-family: Arial, sans-serif;
		font-size: 0.75em;
		font-weight: bold;
		text-transform: uppercase;
		opacity: 1;
		padding: 5px;
		margin: 5px;
	  }
	  #shapes {
		font-family: Arial, sans-serif;
		font-size: 0.75em;
		font-weight: bold;
		text-transform: uppercase;
		opacity: 1;
		padding: 5px;
		margin: 5px;
	  }
	  .legendpadding {
		margin-bottom: 3px;
	  }
    </style>

	<link href="/apis/fusiontables/docs/samples/style/default.css"
        rel="stylesheet" type="text/css">
		
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js">
    </script>
		
    <script type="text/javascript"
        src="http://maps.google.com/maps/api/js?sensor=false"></script>
		
    <script type="text/javascript" src="markerclusterer.js"></script>
		

		
    <script type="text/javascript">
	
		function initialize() {
			var map = new google.maps.Map(document.getElementById('map-canvas'), {
			center: new google.maps.LatLng(25.504721226147495, 12.844390869140625),
			zoom: 2
			});
			
			var style = [
					{
					  featureType: 'all',
					  elementType: 'all',
					  stylers: [
						{ saturation: -85 },
						{ lightness: 57 },
						{ gamma: 0.31 },
						{ hue: "#c8d2a1" }
					  ]
					},
					{
					  featureType: 'road',
					  elementType: 'all',
					  stylers: [
						{ visibility: 'off' }
					  ]
					},
					{
					  featureType: 'poi',
					  elementType: 'all',
					  stylers: [
						{ visibility: 'simplified' }
					  ]
					},
					{
					  featureType: 'administrative.country',
					  elementType: 'all',
					  stylers: [
						{ visibility: 'simplified' }
					  ]
					},
					{
					  featureType: 'administrative.province',
					  elementType: 'all',
					  stylers: [
						{ visibility: 'off' }
					  ]
					},
					{
					  featureType: 'administrative.locality',
					  elementType: 'all',
					  stylers: [
						{ visibility: 'off' }
					  ]
					},
					{
					  featureType: 'administrative.neighborhood',
					  elementType: 'all',
					  stylers: [
						{ visibility: 'off' }
					  ]
					},
					{
					  featureType: 'administrative.land_parcel',
					  elementType: 'all',
					  stylers: [
						{ visibility: 'off' }
					  ]
					},
					{
					  featureType: 'water',
					  elementType: 'all',
					  stylers: [
						{ visibility: 'simplified' }
					  ]
					},
					{
					  featureType: 'transit',
					  elementType: 'all',
					  stylers: [
						{ visibility: 'off' }
					  ]
					}
				  ];
				  var styledMapType = new google.maps.StyledMapType(style, {
					map: map,
					name: 'Styled Map'
				  });
				  map.mapTypes.set('map-style', styledMapType);
				  map.setMapTypeId('map-style');
			
				  
			var firstLayer = new google.maps.FusionTablesLayer({
				query: 	{
					select: 'kml_4326',
					from: '1Tw6AiwneMrSjdDvv7pgNh5bFB-dtumwPxxWsvbWA'
				},
				options: {
					styleId: 3,
					templateId: 4
				},
				map: map
			});
  
			//var secondLayer = new google.maps.FusionTablesLayer({
			//	query: 	{
			//	select: 'longitude_latitude',
			//	from: '1WukvEi1lbr-5Eo0Xn-Vqi5OKS7jhvt1aPmDdOD8I'
			//	},
			//	options: {
			//		styleId: 2,
			//		templateId: 3
			//	},
			//	map: map
			//});
			
			var query = "SELECT Latitude, Longitude, Icon, 'Nr.', Info FROM " +
            '1-cDsCW8T2_L0j6a1NPtY_wHN_hAyLUMay_L4j-IL';
			var encodedQuery = encodeURIComponent(query);

			// Construct the URL
			var url = ['https://www.googleapis.com/fusiontables/v1/query'];
			url.push('?sql=' + encodedQuery);
			url.push('&key=AIzaSyAT76tcYefMoGlGrAgBhFFF22W8JhQyQBI');
			url.push('&callback=?');
			
			//example URL
			//https://www.googleapis.com/fusiontables/v1/query?sql=SELECT longitude_latitude FROM 1WukvEi1lbr-5Eo0Xn-Vqi5OKS7jhvt1aPmDdOD8I LIMIT 5&key=AIzaSyAT76tcYefMoGlGrAgBhFFF22W8JhQyQBI

			// Send the JSONP request using jQuery
			$.ajax({
			  url: url.join(''),
			  dataType: 'jsonp',
			  success: function (data) {
				var rows = data['rows'];				
							
				var markers = [];
					for (var i in rows) {
						//insert info window code
						var infoWindow = new google.maps.InfoWindow();
						
						var lat = rows[i][0]
						var lng = rows[i][1]
						var image = rows[i][2]
						var title = rows[i][3]
						var content = rows[i][4]
						var coordinate = new google.maps.LatLng(lat,lng);
						
						var marker = new google.maps.Marker({'position': coordinate, 
															 'icon': image,
															 'title': 'LÃ¤nderspiel #'+title});
															 
						google.maps.event.addListener(marker, 'mouseover', (function(marker, content) {
						  return function(){
						  infoWindow.setContent(content);
						  infoWindow.open(map, marker);
						  }
						})(marker, content));
						
						google.maps.event.addListener(marker, 'mouseout', function() {
						infoWindow.close();
						});
						
						markers.push(marker);						

					  }

					var markerCluster = new MarkerClusterer(map, markers);
				}
			  });

					var legend = document.getElementById('legend');
						for (var style in styles) {
						  var name = style.name;
						  var icon = style.icon;
						  var div = document.createElement('div');
						  div.innerHTML = '<img src="' + icon + '"> ' + name;
						  legend.appendChild(div);
						}
						
				map.controls[google.maps.ControlPosition.BOTTOM_LEFT].push(
					document.getElementById('legend'));
					
					var legendTitle = document.getElementById('legendTitle');
						for (var style in styles) {
						  var name = style.name;
						  var icon = style.icon;
						  var div = document.createElement('div');
						  div.innerHTML = '<img src="' + icon + '"> ' + name;
						  legend.appendChild(div);
						}
						
				map.controls[google.maps.ControlPosition.LEFT_BOTTOM].push(
					document.getElementById('legendTitle'));					
					
					var shapes = document.getElementById('shapes');
							for (var style in styles) {
							  var name = style.name;
							  var icon = style.icon;
							  var div = document.createElement('div');
							  div.innerHTML = '<img src="' + icon + '"> ' + name;
							  shapes.appendChild(div);
							}
						
				map.controls[google.maps.ControlPosition.BOTTOM_RIGHT].push(
					document.getElementById('shapes'));
			
		}

		google.maps.event.addDomListener(window, 'load', initialize);

    </script>
	
  </head>
  <body>
    <div id="map-canvas"></div>
	<div id="legendTitle" style="z-index: 0; position: absolute; bottom: 150px; left: 55px;" class='legendpadding'>Spiele</div>
	<div id="legend" style="z-index: 0; position: absolute; bottom: 25px; left: 0px;">
		<table>
			<tr>
				<td width="33px" align='center'><img src='icons/m4.png'></td>
				<td>Austragungsort</td>
			</tr>
			<tr>
				<td width="33px" align='center'><img src='https://dl.dropboxusercontent.com/u/24952823/icons/green_dot.png'></td>
				<td>Sieg</td>
			</tr>
			<tr>
				<td width="33px" align='center'><img src='https://dl.dropboxusercontent.com/u/24952823/icons/blue_dot.png'></td>
				<td>Unentschieden</td>
			</tr>
			<tr>
				<td width="33px" align='center'><img src='https://dl.dropboxusercontent.com/u/24952823/icons/red_dot.png'></td>
				<td>Niederlage</td>
			</tr>
			<tr>
				<td width="33px" align='center'><img src='https://dl.dropboxusercontent.com/u/24952823/icons/bw_star.png'></td>
				<td>Pflichtspiel</td>
			</tr>
		</table>
	</div>
	<div id="shapes" style="z-index: 0; position: absolute; bottom: 13px; right: 0px;">
		<div align='center' class='legendpadding'>Bilanzen</div>
		<img src='icons/spielanzahl.png'><br>
		<img src='icons/bilanzstatus.png'>
	</div>
  </body>
</html>